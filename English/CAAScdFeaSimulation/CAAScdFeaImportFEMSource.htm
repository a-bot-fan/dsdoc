<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
<meta http-equiv="Content-Language" content="en-us" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="topictype" content="Uc" />
<meta name="devlang" content="idl" />
<meta name="devlang" content="idl" />
<link rel="stylesheet" type="text/css" href="../CAADocStyleSheets/caav5.css"/>
<script type="text/javascript" src="../CAADocJavaScript/DSDocTocToc.js">/* */</script>
<script type="text/javascript" src="../CAADocJavaScript/DSDocHighlight.js">/* */</script>
<script type="text/javascript" src="../CAADocJavaScript/submit.js">/* */</script>
<title>CAAScdFeaImportFEM.CATScript</title>
</head>

<body onload="highlightSearchTerms();">

<pre>
<span class="comment">'-------------- Sample MACRO written in Basic Script ------------------------------------------</span>
<span class="comment">'This sample imports data into a FEM representation from an Abaqus file format(inp). </span>
<span class="comment">'The Abaqus file will be load from the temporary folder defined by the TMP environment variable.</span>

<span class="comment">'Steps:</span>
<span class="comment">'    1- Retrieve the active editor</span>
<span class="comment">'    2- Retrieve the FEM Root</span>
<span class="comment">'    3- Retrieve the simulation exporter</span>
<span class="comment">'    4- Retrieve the exporter arguments</span>
<span class="comment">'    5- Set the export parameters</span>
<span class="comment">'    6- Execute the export</span>

Sub CATMain()

<span class="comment">'--------------------------------------------------------------------------</span>
<span class="comment">' 1- Retrieve the active editor</span>
<span class="comment">'--------------------------------------------------------------------------</span>
<span class="keyword">Dim</span> myEditor <span class="keyword">As</span> Editor
<span class="keyword">Set</span> myEditor = CATIA.ActiveEditor 

<span class="comment">'--------------------------------------------------------------------------</span>
<span class="comment">' 2- Retrieve the FEM Root</span>
<span class="comment">'--------------------------------------------------------------------------</span>
<span class="keyword">Dim</span> myContext <span class="keyword">As</span> PLMAppContext
<span class="keyword">Set</span> myContext = myEditor.GetService(&quot;PLMProductContext&quot;)
<span class="keyword">Dim</span> myFEMRoot <span class="keyword">As</span> SimFemRoot
<span class="keyword">For Each</span> myEntity <span class="keyword">In</span> myContext.EditedContent

  <span class="keyword">Dim</span> myRef <span class="keyword">As</span> VPMReference
  <span class="keyword">Set</span> myRef = myEntity

  <span class="keyword">Dim</span> myReps <span class="keyword">As</span> VPMRepInstances
  <span class="keyword">Set</span> myReps = myRef.RepInstances

  <span class="keyword">For</span> Each myRep <span class="keyword">In</span> myReps
    <span class="keyword">Dim</span> myRepRef <span class="keyword">As</span> VPMRepReference
    <span class="keyword">Set</span> myRepRef = myRep.ReferenceInstanceOf
    <span class="keyword">Dim</span> attr <span class="keyword">As String</span>
    attr = myRepRef.GetAttributeValue(&quot;V_discipline&quot;)
    <span class="keyword">If</span> ( attr = &quot;FEM&quot; ) <span class="keyword">Then</span>
      <span class="keyword">Set</span> myFEMRoot = myRep.GetItem(&quot;SimFemRoot&quot;)
    <span class="keyword">End if</span>
  <span class="keyword">Next</span>
<span class="keyword">Next</span>
<span class="keyword">If</span> (IsObject(myFEMRoot) = <span class="keyword">false</span>) <span class="keyword">Then</span>
  Exit Sub
<span class="keyword">End if</span>

<span class="comment">'--------------------------------------------------------------------------</span>
<span class="comment">' 3- Retrieve the simulation importer</span>
<span class="comment">'--------------------------------------------------------------------------</span>
<span class="keyword">Dim</span> mySimManagerSIMImport <span class="keyword">As</span> SimManagerSIMImport
<span class="keyword">Set</span> mySimManagerSIMImport = myFEMRoot.GetItem(&quot;SimManagerSIMImport&quot;)

<span class="comment">'--------------------------------------------------------------------------</span>
<span class="comment">' Retrieve the importer arguments</span>
<span class="comment">'--------------------------------------------------------------------------</span>
<span class="keyword">Dim</span> mySimImportArgs <span class="keyword">As</span> SimImportExportArgs
<span class="keyword">Set</span> mySimImportArgs = mySimManagerSIMImport.Args

<span class="comment">'--------------------------------------------------------------------------</span>
<span class="comment">' 5- Set the import parameters</span>
<span class="comment">'--------------------------------------------------------------------------</span>
<span class="keyword">Dim</span> myImportFilePath <span class="keyword">As</span> String
myImportFilePath=CATIA.SystemService.Environ(&quot;TMP&quot;) &amp;  &quot;\CAAScdFeaImportFEM.inp&quot;
mySimImportArgs.SetPath(myImportFilePath)

<span class="comment">'--------------------------------------------------------------------------</span>
<span class="comment">' 6- Manage the import units</span>
<span class="comment">'--------------------------------------------------------------------------</span>
<span class="keyword">Dim</span> MyMagnitude(0)
<span class="keyword">Dim</span> MyUnits(0)
MyMagnitude(0) = &quot;LENGTH&quot;
MyUnits(0) = &quot;mm&quot;
mySimImportArgs.SetUnits MyMagnitude, MyUnits

<span class="comment">'--------------------------------------------------------------------------</span>
<span class="comment">' 7- Execute the import</span>
<span class="comment">'--------------------------------------------------------------------------</span>
mySimManagerSIMImport.Import(&quot;Abaqus2Model&quot;)

End Sub
</pre>

<script type="text/javascript">insertCopyright();</script>
  </body>
</html>
